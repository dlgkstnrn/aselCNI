<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aselcni.JdjOrderMapper">

	<select id="getOrders" resultType="Order">
		SELECT to2.order_no, to2.order_dt, to2.CUST_EMP , to2.REMARK , to2.ORDER_STATUS_CHK , to2.ORDER_END_DT , to2.ORDER_SEC_NO , tc.CUST_NM , tu.USER_NM 
		from TB_ORDER to2
		inner join TB_CUSTMST tc on to2.CUST_CD = tc.CUST_CD 
		inner join TB_USERMST tu on to2.ORDER_EMP_ID = tu.USER_ID
	</select>
	
	<select id="getOrdSpec" parameterType="String" resultType="Order">
		SELECT to2.ORDER_NO , to2.ORDER_DT , to2.ORDER_END_DT , tc.CUST_NM, to2.REMARK , tu.USER_NM, to2.cust_emp
		from TB_ORDER to2 
		inner join TB_CUSTMST tc on to2.CUST_CD = tc.CUST_CD 
		inner join TB_USERMST tu on to2.ORDER_EMP_ID = tu.USER_ID
		WHERE to2.ORDER_sec_no = #{order_sec_num}
	</select>
	
	<select id="getOrdItems" parameterType="String" resultType = "OrderItem">
		SELECT toi.order_no, toi.qty , toi.cost , ti.item_nm , ti.item_unit , toi.item_cd , ti.item_cost
		from TB_ORDER_ITEM toi 
		inner join TB_ITEMMST ti 
		on toi.ITEM_CD = ti.ITEM_CD 
		WHERE toi.order_no = #{order_no}
	</select>

	<select id="getItemLi" parameterType="String" resultType = "Order">
		SELECT *
		FROM TB_ORDER_ITEM
		WHERE ORDER_NO = #{order_no}
	</select>
	
	
	<select id="getCustLi" parameterType="String" resultType = "CustMst">
		SELECT tc.CUST_NM, tc.CUST_CD 
		from TB_CUSTMST tc 
		WHERE tc.BIZ_FLAG = 2
	</select>
	
	<select id="geItemLi" parameterType="String" resultType = "ItemMst">
		select * 
		from TB_ITEMMST ti 
		WHERE ti.ITEM_FLAG = 2
	</select>	
	
	<select id="getUserLi" parameterType="int" resultType = "UserMst">
		SELECT *  from TB_USERMST tu WHERE USER_COMM_CODE = #{user_comm_code};
	</select>	
	
	<select id="getItemInfo" parameterType="String" resultType = "ItemMst">
		SELECT * from TB_ITEMMST ti where ti.ITEM_CD = #{item_cd} 
	</select>
	
	
	<select id="createOrdNo" parameterType="String" resultType="String">
		SELECT CONCAT('ORD', RIGHT(REPLACE(#{order_dt},'-',''),6) , FORMAT(ISNULL(COUNT(to2.order_dt),0)+1, '0000')) AS order_no
		FROM TB_ORDER to2
		WHERE to2.order_dt = #{order_dt};
	</select>
	<insert id="regOrder" parameterType="Order">
		INSERT into tb_order (order_no,ORDER_DT, CUST_CD , CUST_EMP,REMARK , ORDER_EMP_ID, ORDER_DELETE_CHK, ORDER_STATUS_CHK, ORDER_END_DT, ORDER_SEC_NO)
		values(#{order_no}, #{order_dt},#{cust_cd}, #{cust_emp},#{remark}, #{order_emp_id}, 0,0, #{order_end_dt}, #{order_sec_no});
	</insert>
	<insert id="regOrderItem" parameterType="OrderItem">
		INSERT into tb_order_item (order_no,item_cd, qty , cost)
		values(#{order_no}, #{item_cd},#{qty}, #{cost});
	</insert>
	
</mapper>