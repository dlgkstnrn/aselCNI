<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aselcni.lhs.LhsCustMst">

	<select id="selectListTypeBig" resultType="LhsTypeBig">
		select *
		from tb_type_big;
	</select>
	
	<select id="selectListTypeMid" parameterType="LhsTypeMid" resultType="LhsTypeMid">
		select *
		from tb_type_mid
		where big_no = #{big_no}
	</select>
	
	<select id="selectListTypeSml" parameterType="LhsTypeSml" resultType="LhsTypeSml">
		select *
		from tb_type_sml
		where big_no = #{big_no}
		and mid_no = #{mid_no}
	</select>
	
	<select id="selectItemCntByitemCd" parameterType="LhsItemMst" resultType="int">
		select count(*)
		from tb_itemmst
		where item_cd = #{item_cd}
	</select>
	
	<select id="selectItemByitemCd" parameterType="LhsItemMst" resultType="LhsItemMst">
		select *
		from tb_itemmst
		where item_cd = #{item_cd}
	</select>
	
	<insert id="insertItem" parameterType="LhsItemMst">
		insert into
		tb_itemmst
		values(
			#{item_cd},
			#{item_nm},
			#{item_flag},
			<choose>
				<when test="cust_cd=='거래처선택'">
					null,
				</when>
				<otherwise>
				#{cust_cd},
				</otherwise>
			</choose>
			#{big_no},
			#{mid_no},
			#{sml_no},
			#{item_spec},
			#{item_unit},
			#{item_cost},
			#{remark},
			CONVERT(CHAR(10),GETDATE(),23),
			null,
			#{item_emp_id},
			0
		)
	</insert>
	
	<select id="selectItemCnt" parameterType="LhsItemMst" resultType="int">
		select count(*)
		from tb_itemmst
		where item_flag = #{item_flag}
		and item_delete_chk = 0
		<if test="big_no != 0">
			and big_no = #{big_no}
		</if>
		<if test="mid_no != 0">
			and mid_no = #{mid_no}
		</if>
		<if test="sml_no != 0">
			and sml_no = #{sml_no}
		</if>
		<choose>
			<when test="searchFilter=='item_cd'">
				and item_cd like '%'+#{keyword}+'%'
			</when>
			<when test="searchFilter=='item_nm'">
				and item_nm like '%'+#{keyword}+'%'
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<select id="selectItem" parameterType="LhsItemMst" resultType="LhsItemMst">
		select rn.*, c.cust_nm
		from (select ROW_NUMBER() over(order by (select 1)) as rn, i.*
		      from tb_itemmst i
		      where i.item_flag = #{item_flag}
		      and i.item_delete_chk = 0
		      <if test="big_no != 0">
					and big_no = #{big_no}
			  </if>
			  <if test="mid_no != 0">
					and mid_no = #{mid_no}
			  </if>
			  <if test="sml_no != 0">
					and sml_no = #{sml_no}
			  </if>
		      <choose>
				<when test="searchFilter=='item_cd'">
					and i.item_cd like '%'+#{keyword}+'%'
				</when>
				<when test="searchFilter=='item_nm'">
					and i.item_nm like '%'+#{keyword}+'%'
				</when>
				<otherwise>
				</otherwise>
			  </choose>) rn
		left outer join tb_custmst c
		on rn.cust_cd = c.cust_cd
		where rn BETWEEN #{start} and #{end}
	</select>
	
	<update id="updateItem" parameterType="LhsItemMst">
		update tb_itemmst
		set
		item_nm=#{item_nm},
		cust_cd=#{cust_cd},
		big_no=#{big_no},
		mid_no=#{mid_no},
		sml_no=#{sml_no},
		item_spec=#{item_spec},
		item_unit=#{item_unit},
		item_cost=#{item_cost},
		remark=#{remark},
		item_update=CONVERT(CHAR(10),GETDATE(),23)
		where item_cd = #{item_cd}
	</update>
	
	<update id="deleteItem" parameterType="LhsItemMst">
		update tb_itemmst
		set
		item_delete_chk = 1
		where item_cd = #{item_cd}
	</update>
    
</mapper>